# EchoStream 开发路线图

本文档描述了 EchoStream 项目的版本规划和功能里程碑。

## 开发原则

- **迭代式开发**: 每个版本都是可用的，新版本在旧版本基础上增量改进
- **向后兼容**: 尽可能保持 API 的向后兼容性
- **质量优先**: 每个版本都需要通过完整的测试和性能基准测试
- **文档同步**: 代码和文档同步更新

## 版本里程碑

### v0.1.0 - 基础框架（MVP）

> **目标**: 建立基础的 QUIC 连接和简单的 RPC 功能，验证核心架构设计

#### 核心功能
- [x] 项目初始化和模块划分
- [ ] QUIC 连接管理
  - [ ] 基于 quinn 的 Endpoint 封装
  - [ ] 客户端连接建立
  - [ ] 服务端监听和接受连接
  - [ ] 自签名证书生成（开发模式）
- [ ] 基础协议层
  - [ ] Frame 类型定义（Request, Response）
  - [ ] 基于 bincode 的序列化/反序列化
  - [ ] MessageId 生成和管理
- [ ] Request/Response RPC
  - [ ] 客户端请求发送
  - [ ] 服务端请求接收和路由
  - [ ] 异步响应返回
  - [ ] 超时控制
- [ ] 错误处理
  - [ ] 统一的 Error 和 Result 类型
  - [ ] 传输层错误处理
  - [ ] 协议层错误处理

#### 开发者体验
- [ ] 基础 API 设计
- [ ] 示例代码（echo server/client）
- [ ] 单元测试框架搭建

#### 文档
- [ ] 快速开始指南
- [ ] API 基础文档
- [ ] 协议规范初稿

**预计完成时间**: 2-3 周
**交付标准**: 可以运行简单的请求-响应 RPC，支持基本的错误处理

---

### v0.2.0 - Event 和基础 Stream

> **目标**: 实现事件通知和基础的流传输能力

#### 核心功能
- [ ] Event 机制
  - [ ] Event Frame 定义
  - [ ] 事件发送和接收
  - [ ] 事件监听器注册
  - [ ] 多监听器支持
- [ ] 基础 Stream
  - [ ] Stream Frame 定义
  - [ ] 流初始化和握手
  - [ ] 双向数据传输
  - [ ] StreamSender/StreamReceiver API
  - [ ] 流生命周期管理（创建、关闭、清理）

#### 开发者体验
- [ ] 更人性化的 Builder API
- [ ] 示例代码（聊天室、文件传输）

#### 测试
- [ ] Event 功能测试
- [ ] Stream 基础功能测试
- [ ] 多客户端并发测试

#### 文档
- [ ] Event 使用指南
- [ ] Stream 使用指南

**预计完成时间**: 2-3 周
**交付标准**: 支持事件通知和简单的流传输，可以实现基础的聊天应用

---

### v0.3.0 - 服务发现

> **目标**: 实现 mDNS 服务发现，简化局域网部署

#### 核心功能
- [ ] mDNS 服务发现
  - [ ] 基于 mdns-sd 的服务广播
  - [ ] 服务浏览和查找
  - [ ] ServiceInfo 元数据定义
  - [ ] 动态服务注册/注销
- [ ] Discovery API
  - [ ] `RpcServer::enable_discovery()`
  - [ ] `RpcClient::discover()`
  - [ ] 服务过滤和选择
- [ ] 容错处理
  - [ ] 服务掉线检测
  - [ ] 自动重连

#### 开发者体验
- [ ] 零配置示例
- [ ] 手动指定地址作为后备方案

#### 测试
- [ ] 服务发现功能测试
- [ ] 多服务实例测试
- [ ] 网络分区恢复测试

#### 文档
- [ ] 服务发现指南
- [ ] 部署模式说明

**预计完成时间**: 1-2 周
**交付标准**: 支持局域网零配置服务发现，客户端可以自动找到服务端

---

### v0.4.0 - 时间同步协议

> **目标**: 实现时间同步协议，为音视频同步打基础

#### 核心功能
- [ ] 时间同步协议
  - [ ] TimeSync Frame 定义
  - [ ] NTP 风格的时间戳交换
  - [ ] 延迟和偏移计算
  - [ ] 时钟漂移补偿
- [ ] 同步 Stream API
  - [ ] `with_time_sync()` 配置
  - [ ] `send_with_timestamp()`
  - [ ] `recv_aligned()`
  - [ ] 时间戳转换工具
- [ ] 性能优化
  - [ ] 定期自动同步
  - [ ] 同步精度监控

#### 开发者体验
- [ ] 时间同步示例（音频同步）
- [ ] 同步质量诊断工具

#### 测试
- [ ] 时间同步精度测试
- [ ] 网络延迟模拟测试
- [ ] 长时间运行稳定性测试

#### 文档
- [ ] 时间同步原理说明
- [ ] 音视频同步最佳实践

**预计完成时间**: 2-3 周
**交付标准**: 支持精确的时间同步，可以实现基础的音频同步播放

---

### v0.5.0 - 抖动缓冲和流控制

> **目标**: 完善流传输质量，实现生产级的实时传输

#### 核心功能
- [ ] 抖动缓冲
  - [ ] JitterBuffer 实现
  - [ ] 自适应缓冲区大小
  - [ ] 丢包检测和处理
  - [ ] 乱序重排
- [ ] 流控制
  - [ ] 背压机制
  - [ ] 发送速率控制
  - [ ] 接收窗口管理
- [ ] QoS 指标
  - [ ] 延迟监控
  - [ ] 丢包率统计
  - [ ] 吞吐量统计

#### 开发者体验
- [ ] 流质量监控 API
- [ ] 性能调优指南

#### 测试
- [ ] 网络抖动模拟测试
- [ ] 高丢包环境测试
- [ ] 压力测试

#### 文档
- [ ] 流控制原理
- [ ] 性能调优文档

**预计完成时间**: 2-3 周
**交付标准**: 流传输质量稳定，可以在不理想的网络环境下工作

---

### v0.6.0 - 过程宏和中间件

> **目标**: 提升开发者体验，简化代码

#### 核心功能
- [ ] 过程宏 (echostream-derive)
  - [ ] `#[echostream::handler]` 自动注册处理器
  - [ ] `#[echostream::service]` 生成服务接口
  - [ ] `#[echostream::event]` 定义事件类型
  - [ ] `#[echostream::listener]` 注册事件监听器
- [ ] 中间件支持
  - [ ] 中间件接口定义
  - [ ] 中间件链执行
  - [ ] 内置中间件（日志、认证）
- [ ] Context 增强
  - [ ] 请求元数据
  - [ ] 中间件数据共享

#### 开发者体验
- [ ] 声明式 API 示例
- [ ] 中间件开发指南

#### 测试
- [ ] 过程宏测试
- [ ] 中间件链测试

#### 文档
- [ ] 过程宏使用指南
- [ ] 中间件开发文档

**预计完成时间**: 2-3 周
**交付标准**: 提供声明式 API，大幅减少样板代码

---

### v0.7.0 - 性能优化

> **目标**: 全面优化性能，进行基准测试

#### 核心功能
- [ ] 零拷贝优化
  - [ ] 深度使用 `bytes::Bytes`
  - [ ] 避免不必要的克隆
- [ ] 内存优化
  - [ ] 对象池
  - [ ] 内存复用
- [ ] 并发优化
  - [ ] 任务调度优化
  - [ ] 锁竞争分析和优化

#### 性能基准
- [ ] 建立基准测试套件
- [ ] 延迟基准测试
- [ ] 吞吐量基准测试
- [ ] 与其他框架对比

#### 文档
- [ ] 性能报告
- [ ] 性能优化指南

**预计完成时间**: 2-3 周
**交付标准**: 性能达到生产级别，有完整的基准测试数据

---

### v0.8.0 - 安全增强

> **目标**: 增强安全性，支持生产环境部署

#### 核心功能
- [ ] 证书管理
  - [ ] CA 证书支持
  - [ ] 客户端证书验证
  - [ ] 证书轮换
- [ ] 认证和授权
  - [ ] Token 认证中间件
  - [ ] 权限控制框架
  - [ ] 速率限制
- [ ] 安全审计
  - [ ] 连接审计日志
  - [ ] 敏感操作记录

#### 测试
- [ ] 安全测试
- [ ] 压力测试（防 DDoS）

#### 文档
- [ ] 安全部署指南
- [ ] 证书配置文档

**预计完成时间**: 1-2 周
**交付标准**: 安全性达到生产级别

---

### v0.9.0 - 可观测性

> **目标**: 完善日志、追踪和指标，便于问题诊断

#### 核心功能
- [ ] 结构化日志
  - [ ] 基于 tracing 的完整日志
  - [ ] 日志级别控制
  - [ ] 上下文传播
- [ ] 指标收集
  - [ ] Prometheus 指标导出
  - [ ] 连接、请求、流的指标
  - [ ] 性能指标
- [ ] 分布式追踪
  - [ ] OpenTelemetry 集成
  - [ ] Trace ID 传播

#### 开发者体验
- [ ] 诊断工具
- [ ] 监控仪表板示例

#### 文档
- [ ] 可观测性指南
- [ ] 监控最佳实践

**预计完成时间**: 1-2 周
**交付标准**: 提供完整的可观测性支持

---

### v1.0.0 - 正式发布

> **目标**: 稳定 API，发布第一个正式版本

#### 核心任务
- [ ] API 稳定化
  - [ ] API 审查和优化
  - [ ] 向后兼容性保证
- [ ] 文档完善
  - [ ] 完整的用户文档
  - [ ] API 参考文档
  - [ ] 示例代码库
- [ ] 质量保证
  - [ ] 完整的测试覆盖
  - [ ] 压力测试和稳定性测试
  - [ ] 生产环境验证
- [ ] 社区建设
  - [ ] 贡献指南
  - [ ] 行为准则
  - [ ] Issue 模板

**预计完成时间**: 1-2 周
**交付标准**: API 稳定，文档完善，可以用于生产环境

---

## 后续版本规划（v1.1+）

### v1.1 - 跨语言支持
- FFI 接口设计
- C 语言绑定
- Python 绑定

### v1.2 - 高级流控制
- 多码率流（Simulcast）
- 动态码率调整（ABR）
- 前向纠错（FEC）

### v1.3 - 云原生支持
- Kubernetes 集成
- 服务网格集成
- 分布式配置管理

### v1.4 - 更多传输协议
- WebTransport 支持
- WebRTC 互操作
- 传输层插件化

### v2.0 - 架构演进
- 插件系统
- 热重载支持
- 更灵活的编解码器

## 版本发布流程

1. **功能开发**: 在 `main` 分支开发
2. **内部测试**: 功能完成后进行内部测试
3. **发布候选**: 创建 `rc` 分支，发布 RC 版本
4. **社区测试**: 收集社区反馈，修复问题
5. **正式发布**: 合并到 `main`，打 tag，发布到 crates.io

## 版本命名规则

- **主版本号**: 重大架构变更或不兼容的 API 变更
- **次版本号**: 新增功能，保持向后兼容
- **修订版本号**: Bug 修复和小改进

## 反馈和建议

我们欢迎社区对路线图的反馈和建议：

- 通过 GitHub Issues 提出功能建议
- 在 Discussions 中讨论优先级
- 贡献代码加速功能实现

---

**最后更新**: 2026-01-08
